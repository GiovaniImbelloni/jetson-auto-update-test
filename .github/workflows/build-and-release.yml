name: Build and Release ServicoTeste (ARM64)

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v3

      - name: Instalar dependências
        run: sudo apt update && sudo apt install -y build-essential crossbuild-essential-arm64

      - name: Compilar para ARM64
        run: |
          export CC=aarch64-linux-gnu-g++
          make

      - name: Criar Release numerada
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ env.VERSION }}  # Gera releases numeradas (ex: v20250312123045)
        files: servico_teste
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Criar Release "latest"
      uses: softprops/action-gh-release@v1
      with:
        tag_name: servico_teste-latest
        files: servico_teste
        make_latest: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
